<template>
  <div class="w-full">
    <div class="flex flex-col items-center font-bold mt-10">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="45"
        height="45"
        viewBox="0 0 45 45"
        fill="none"
      >
        <path
          d="M0 0.0779495C0 0.139999 0.0737377 0.375778 0.172055 0.599148C0.270372 0.822514 0.688219 1.95177 1.10607 3.11826C1.52391 4.27233 1.94176 5.43882 2.04008 5.687C2.13839 5.9476 2.28587 6.36952 2.38419 6.61771C2.4825 6.8783 2.90035 8.03238 3.3182 9.19886C3.73604 10.3529 4.1416 11.507 4.23992 11.7428C4.33823 11.9786 4.67005 12.8969 4.97729 13.7903C5.29682 14.6714 5.62864 15.6269 5.73925 15.8999C6.2677 17.2774 7.54583 20.8141 7.8162 21.6083C7.95138 22.0178 7.97596 22.2784 7.90222 22.4149C7.77933 22.601 7.39835 23.3084 6.63639 24.7106C5.77612 26.3114 5.46888 26.8699 4.97729 27.7509C4.69463 28.2597 4.27679 29.0167 4.05557 29.4262C3.41651 30.6175 3.13385 31.1139 2.70372 31.8833C2.4825 32.2804 2.32274 32.6154 2.34732 32.6402C2.3719 32.6651 3.06011 33.0001 3.87123 33.3972C4.68234 33.7943 6.29228 34.5761 7.43522 35.1345C8.59044 35.6929 10.3601 36.5616 11.3679 37.058C16.3944 39.5026 15.5709 38.969 19.1595 42.1334C20.9415 43.7094 22.4286 45 22.4777 45C22.5269 45 22.6743 44.9007 22.8095 44.7766C23.0922 44.5284 24.9479 42.8904 25.6361 42.2823C27.6639 40.5078 28.7208 39.5771 28.856 39.453C29.0035 39.3041 30.1956 38.7084 34.2266 36.7477C35.2466 36.2514 36.9549 35.4199 38.0364 34.8863C39.1179 34.3651 40.5803 33.6454 41.2931 33.2979C42.0059 32.9629 42.5958 32.6651 42.6204 32.6526C42.6573 32.6154 42.35 32.0198 41.6372 30.7292C41.035 29.6372 39.6709 27.1677 39.1179 26.1377C38.9089 25.7654 38.3436 24.7354 37.8643 23.8544C37.385 22.9857 36.9917 22.2039 36.9917 22.1295C36.9917 22.0054 37.6431 20.144 38.1593 18.8162C38.3436 18.3446 39.6955 14.6094 40.9244 11.1844C41.711 8.97549 41.883 8.51635 42.1903 7.70974C42.3009 7.43673 42.7187 6.25784 43.1366 5.10376C43.5544 3.93727 43.9723 2.79561 44.0583 2.55983C44.3901 1.70358 44.98 0.0531311 44.98 0.00349426C44.98 -0.0585518 43.8494 0.710831 42.1903 1.90213C40.4574 3.14307 37.6554 5.14099 36.1315 6.22061C35.7628 6.4812 34.5953 7.31263 33.5507 8.0572C32.506 8.81417 31.0927 9.81934 30.4168 10.2909C29.7409 10.7749 28.8069 11.445 28.3276 11.7924L27.4796 12.4253L22.5023 12.4377H17.525L15.6078 11.0603C14.5632 10.3033 12.732 8.9879 11.5522 8.14407C10.3724 7.31263 9.15576 6.44398 8.84852 6.22061C8.54128 6.00965 7.63185 5.35195 6.82074 4.78112C4.59632 3.21753 4.44884 3.10585 3.25675 2.2496C0.811115 0.49987 0 -0.0461426 0 0.0779495ZM5.30911 32.119C5.43201 32.1811 5.76383 32.268 6.04649 32.33C6.34144 32.392 7.34919 32.6402 8.29549 32.9008C9.24179 33.149 10.2127 33.4096 10.4462 33.4593C10.6797 33.5213 11.626 33.7571 12.5354 34.0053C13.4448 34.241 15.1285 34.6754 16.2837 34.9732L18.3607 35.4944L20.4253 37.5916L22.49 39.6888L24.5178 37.604L26.5456 35.5316L28.1678 35.1097C29.0649 34.8739 29.999 34.6381 30.2325 34.5761C30.6503 34.4768 31.4614 34.2659 36.1929 33.0249C37.4096 32.7023 38.6386 32.392 38.9335 32.33C39.2162 32.268 39.548 32.1811 39.6709 32.119C39.7815 32.057 40.0396 31.9701 40.2362 31.9205C40.863 31.7716 40.4083 32.1439 39.3514 32.6651C38.8352 32.9132 37.5202 33.5585 36.4387 34.0797C32.3463 36.0776 30.0235 37.2193 29.1633 37.6412C28.2907 38.088 27.8974 38.3982 24.2228 41.6246L22.4777 43.1634L21.728 42.4933C21.3102 42.1334 20.0198 40.9918 18.8646 39.9742C17.697 38.9442 16.505 37.9887 16.21 37.8398C15.3006 37.393 11.0975 35.3331 9.40156 34.5141C5.89902 32.8264 4.68234 32.1935 4.53487 32.0198C4.39968 31.8584 4.42426 31.846 4.74379 31.9205C4.94043 31.9701 5.19851 32.057 5.30911 32.119Z"
          fill="black"
        />
      </svg>
      <h1 class="text-5xl text-orange">Fox Insight</h1>
    </div>
    <div class="flex flex-col items-center mt-60 px-6">
      <h2 class="text-4xl text-green font-semibold">Sign Up</h2>
      <form
        @submit.prevent="signUp"
        class="flex flex-col items-center w-full mt-12"
      >
        <input
          v-model="email"
          type="email"
          class="h-12 border border-gray-dark rounded-md w-full px-3 py-1"
          placeholder="Enter your email"
          required="true"
        />
        <input
          v-model="username"
          type="text"
          class="h-12 mt-7 border border-gray-dark rounded-md w-full px-3 py-1"
          placeholder="Enter your username"
          required="true"
        />
        <input
          v-model="password"
          type="password"
          class="h-12 mt-7 border border-gray-dark rounded-md w-full px-3 py-1"
          placeholder="Enter your password"
          required="true"
        />
        <p class="text-red">{{ errorMsg }}</p>
        <button
          class="h-12 mt-16 bg-green text-white font-medium w-full rounded-md flex justify-center items-center"
          type="submit"
        >
          Sign Up
        </button>

        <NuxtLink
          to="/signin"
          class="h-12 mt-2 text-gray-dark font-medium w-full hover:bg-gray-light flex justify-center items-center"
          >Sign in</NuxtLink
        >
      </form>
    </div>
    <div
      class="absolute left-6 right-6 top-1/2 -translate-y-1/2 bg-gray-light drop-shadow-md shadow-orange z-10 flex flex-col items-center py-4"
      v-if="successMsg != null"
    >
      <h3 class="text-xl font-semibold text-gray-dark">Account created!</h3>
      <p class="text-green mt-2">{{ successMsg }}</p>
      <NuxtLink
        class="bg-green text-white py-1 px-3 rounded-md mt-5"
        to="/signin"
        >Sign in</NuxtLink
      >
    </div>
  </div>
</template>

<script setup>
const client = useSupabaseClient();
const router = useRouter();

const email = ref("");
const username = ref(null);
const password = ref(null);
const errorMsg = ref(null);
const successMsg = ref(null);

async function signUp() {
  try {
    const { data, error } = await client.auth.signUp({
      email: email.value,
      password: password.value,
      options: {
        data: {
          username: username.value,
        },
      },
    });
    if (error) throw error;
    errorMsg.value = null;
    successMsg.value = "Check your email to confirm your account";
  } catch (error) {
    errorMsg.value = error.message;
  }
}
</script>
